[{"id":"f747c741.9f87e","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"144ea2c7.416add","type":"tcp in","z":"f747c741.9f87e","name":"","server":"client","host":"localhost","port":"60002","datamode":"stream","datatype":"utf8","newline":"\\n","topic":"","base64":false,"x":500,"y":360,"wires":[["93ed4db8.1923d","ea87a4cb.e439b"]]},{"id":"93ed4db8.1923d","type":"debug","z":"f747c741.9f87e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":670,"y":240,"wires":[]},{"id":"cb0dba2e.b7d93","type":"debug","z":"f747c741.9f87e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":960,"y":260,"wires":[]},{"id":"ea87a4cb.e439b","type":"function","z":"f747c741.9f87e","name":"Parsing msg","func":"var stringArray;\nvar nodeID;\nvar regexValue = \"CONTENT:\"\nvar regexId = \"NODE:\"\n\nstringArray = msg.payload.split(\" \");\n\nfor(var i = 0; i < stringArray.length; i++){\n    if(stringArray[i].match(regexValue)){\n        flow.set(\"content\", stringArray[i+1]);\n    } else if(stringArray[i].match(regexId)){\n        nodeID = stringArray [i+1];\n    }\n}\n\nmsg.payload = Number(nodeID);\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":360,"wires":[["cb0dba2e.b7d93","650b86ae.7e10c"]]},{"id":"650b86ae.7e10c","type":"function","z":"f747c741.9f87e","name":"Topic setting","func":"var topic;\nvar field;\n\nswitch(msg.payload){\n    case 1:\n        field=\"field1\";\n        break;\n    case 2:\n        field=\"field2\";\n        break;\n    case 3:\n        field=\"field3\";\n        break;\n    case 4:\n        field=\"field4\";\n        break;\n    case 5:\n        field=\"field5\";\n        break;\n}\n\ntopic = \"channels/2227986/publish/fields/\"+field+\"/MKUTFWS2079169KV\";\nmsg.topic = topic;\nmsg.payload = flow.get(\"content\");\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":360,"wires":[["ec1c7a49.67da2","fb69cb1.ac965b8"]]},{"id":"724e3a4b.b6ed74","type":"mqtt out","z":"f747c741.9f87e","name":"","topic":"","qos":"","retain":"","broker":"d84fc365.723068","x":1430,"y":360,"wires":[]},{"id":"ec1c7a49.67da2","type":"delay","z":"f747c741.9f87e","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1230,"y":360,"wires":[["724e3a4b.b6ed74"]]},{"id":"fb69cb1.ac965b8","type":"debug","z":"f747c741.9f87e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":1170,"y":300,"wires":[]},{"id":"d84fc365.723068","type":"mqtt-broker","z":"","name":"","broker":"mqtt.thingspeak.com","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""}]
